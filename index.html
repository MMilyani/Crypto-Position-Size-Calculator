<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Risk Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Soothing Sage" - A calm palette with off-white, sage green, and dark slate gray for a professional and focused feel. -->
    <!-- Application Structure Plan: A single-view, dashboard-style calculator. The layout uses a two-column grid on larger screens to separate user inputs from the calculated results and visualization, creating a clear, task-oriented flow. On mobile, it stacks into a single column for usability. This structure was chosen to make the tool intuitive and provide immediate feedback, which is more effective for a user's goal of quick calculation than a static page. -->
    <!-- Visualization & Content Choices: 
        - Report Info: User inputs (Capital, Risk %, Entry, Stop-Loss). Goal: User Input. Method: Interactive form with a slider for risk %. Interaction: Real-time updates on input change. Justification: Sliders and number inputs are standard and intuitive for data entry. Real-time updates provide immediate feedback. Library/Method: HTML, JS.
        - Report Info: Calculated values (Position Size, Risk Amount, Total Position Value, Leverage). Goal: Inform. Method: Prominent display of key results. Interaction: Values update dynamically. Justification: The primary goal is to get these numbers, so they must be clear and easy to read. Library/Method: HTML, JS.
        - Report Info: The concept of risking a small part of capital. Goal: Compare/Relate. Method: Donut chart. Interaction: Hover tooltips showing values. Justification: A donut chart provides an immediate, powerful visual comparison of the amount at risk versus the remaining capital, making the abstract 2% rule tangible. Library/Method: Chart.js (Canvas).
        - Report Info: Explanation of the 2% rule. Goal: Inform. Method: A clear text block. Justification: Provides necessary context for users to understand the "why" behind the calculation. Library/Method: HTML.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 280px;
            width: 280px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #334155;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type=range]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #334155;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-6xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Crypto Position Size Calculator</h1>
            <p class="text-slate-600 mt-2">Manage your trades effectively by adhering to a consistent risk management strategy.</p>
        </header>

        <main class="bg-white rounded-2xl shadow-lg p-6 sm:p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                
                <!-- Input Section -->
                <div class="space-y-6">
                    <div>
                        <h2 class="text-2xl font-semibold text-slate-900 mb-4">Trade Parameters</h2>
                        <p class="text-slate-500 mb-6">Enter your account and trade details below. The position size will update automatically.</p>
                    </div>
                    
                    <div>
                        <label for="totalCapital" class="block text-sm font-medium text-slate-700">Your Total Capital ($)</label>
                        <div class="mt-1">
                            <input type="number" id="totalCapital" value="10000" class="w-full p-3 bg-slate-100 border-transparent border-2 focus:border-teal-500 focus:ring-0 rounded-lg transition">
                        </div>
                    </div>

                    <div>
                        <label for="riskPercentage" class="block text-sm font-medium text-slate-700">Risk Percentage (<span id="riskPercentageValue">2.0</span>%)</label>
                        <div class="mt-1">
                            <input type="range" id="riskPercentage" min="0.1" max="10" step="0.1" value="2" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>

                    <div>
                        <label for="entryPrice" class="block text-sm font-medium text-slate-700">Entry Price ($)</label>
                        <div class="mt-1">
                            <input type="number" id="entryPrice" value="50000" class="w-full p-3 bg-slate-100 border-transparent border-2 focus:border-teal-500 focus:ring-0 rounded-lg transition">
                        </div>
                    </div>

                    <div>
                        <label for="stopLossPrice" class="block text-sm font-medium text-slate-700">Stop-Loss Price ($)</label>
                        <div class="mt-1">
                            <input type="number" id="stopLossPrice" value="49000" class="w-full p-3 bg-slate-100 border-transparent border-2 focus:border-teal-500 focus:ring-0 rounded-lg transition">
                        </div>
                    </div>
                </div>

                <!-- Output Section -->
                <div class="bg-slate-100 rounded-xl p-6 sm:p-8 flex flex-col justify-between">
                    <div>
                        <h2 class="text-2xl font-semibold text-slate-900 mb-4">Calculated Results</h2>
                        <div class="space-y-4">
                            <div class="p-4 bg-white rounded-lg">
                                <p class="text-sm text-slate-500">Risk Amount per Trade</p>
                                <p id="riskAmountDisplay" class="text-2xl font-semibold text-teal-600">$200.00</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg">
                                <p class="text-sm text-slate-500">Total Position Value</p>
                                <p id="positionValueDisplay" class="text-2xl font-semibold text-slate-800">$10,000.00</p>
                            </div>
                            <div class="p-4 bg-white rounded-lg">
                                <p class="text-sm text-slate-500">Leverage</p>
                                <p id="leverageDisplay" class="text-2xl font-semibold text-slate-800">1.00X</p>
                            </div>
                            <div class="p-6 bg-teal-600 text-white rounded-lg text-center">
                                <p class="text-base font-medium opacity-80">Calculated Position Size (Units)</p>
                                <p id="positionSizeDisplay" class="text-4xl font-bold">0.2000</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                    </div>
                </div>

            </div>

             <!-- Explanation Section -->
            <div class="mt-12 border-t border-slate-200 pt-8">
                <h3 class="text-xl font-semibold text-slate-900">Understanding the 2% Risk Rule and Leverage</h3>
                <p class="text-slate-600 mt-4">
                    This tool is built on a fundamental principle of risk management: never risk more than a small, predefined percentage of your total trading capital on a single trade. A common guideline, especially for new traders, is the 2% rule.
                </p>
                <p class="text-slate-600 mt-4">
                    By limiting your potential loss on any given trade to 2% of your capital, you protect yourself from significant drawdowns and can withstand a series of losing trades without depleting your account. This disciplined approach is crucial for long-term survival and success in volatile markets like cryptocurrency. The position size is calculated to ensure that if your stop-loss is triggered, your loss will equal your chosen risk amount.
                </p>
                <p class="text-slate-600 mt-4">
                    **Leverage** allows you to control a larger position in the market with a relatively smaller amount of your own capital. The "Total Position Value" is the notional size of your trade, while "Leverage" indicates how many times your actual capital is being amplified to achieve that position. For example, a 5X leverage means you are controlling a position five times larger than your capital allocated to that trade. It's important to remember that leverage amplifies both profits and losses.
                </p>
            </div>
        </main>

    </div>

    <script>
        const totalCapitalEl = document.getElementById('totalCapital');
        const riskPercentageEl = document.getElementById('riskPercentage');
        const riskPercentageValueEl = document.getElementById('riskPercentageValue');
        const entryPriceEl = document.getElementById('entryPrice');
        const stopLossPriceEl = document.getElementById('stopLossPrice');

        const riskAmountDisplayEl = document.getElementById('riskAmountDisplay');
        const positionValueDisplayEl = document.getElementById('positionValueDisplay');
        const leverageDisplayEl = document.getElementById('leverageDisplay');
        const positionSizeDisplayEl = document.getElementById('positionSizeDisplay');

        const riskChartCanvas = document.getElementById('riskChart');
        let riskChart;

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        }

        function calculateAndDisplay() {
            const totalCapital = parseFloat(totalCapitalEl.value) || 0;
            const riskPercentage = parseFloat(riskPercentageEl.value) / 100 || 0;
            const entryPrice = parseFloat(entryPriceEl.value) || 0;
            const stopLossPrice = parseFloat(stopLossPriceEl.value) || 0;

            riskPercentageValueEl.textContent = (riskPercentage * 100).toFixed(1);

            const riskAmount = totalCapital * riskPercentage;
            const riskPerUnit = Math.abs(entryPrice - stopLossPrice);

            let positionSize = 0;
            if (riskPerUnit > 0) {
                positionSize = riskAmount / riskPerUnit;
            }
            
            const positionValue = positionSize * entryPrice;

            let leverage = 0;
            if (totalCapital > 0) {
                leverage = positionValue / totalCapital;
            }

            riskAmountDisplayEl.textContent = formatCurrency(riskAmount);
            positionValueDisplayEl.textContent = formatCurrency(positionValue);
            
            // Updated leverage display logic
            if (leverage <= 1) {
                leverageDisplayEl.textContent = "1.00X (No Leverage)"; 
            } else {
                leverageDisplayEl.textContent = leverage.toFixed(2) + 'X';
            }

            if (riskPerUnit > 0) {
                 positionSizeDisplayEl.textContent = positionSize.toFixed(4);
            } else {
                 positionSizeDisplayEl.textContent = "N/A";
            }
           
            updateChart(riskAmount, totalCapital);
        }

        function updateChart(riskAmount, totalCapital) {
            const remainingCapital = Math.max(0, totalCapital - riskAmount);
            
            if (riskChart) {
                riskChart.data.datasets[0].data = [riskAmount, remainingCapital];
                riskChart.update();
            }
        }

        function initializeChart() {
            const ctx = riskChartCanvas.getContext('2d');
            riskChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Amount at Risk', 'Remaining Capital'],
                    datasets: [{
                        data: [0, 10000],
                        backgroundColor: [
                            '#ef4444', // Red for risk
                            '#0d9488'  // Teal for safe
                        ],
                        borderColor: [
                            '#ffffff',
                            '#ffffff'
                        ],
                        borderWidth: 4,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#475569',
                                font: {
                                    family: "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += formatCurrency(context.parsed);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeChart();
            calculateAndDisplay();

            [totalCapitalEl, riskPercentageEl, entryPriceEl, stopLossPriceEl].forEach(el => {
                el.addEventListener('input', calculateAndDisplay);
            });
        });
    </script>
</body>
</html>
